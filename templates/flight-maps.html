<!-- <!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Volo {{ volo.flight_iata }}</title>

    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .leaflet-popup-content {
            font-size: 14px;
        }
    </style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    const volo = {{ volo | tojson }};

    // Dati minimi necessari
    const heading = volo.dir || 0;
    const altitude = volo.alt || "N/D";

    // Coordinate SOLO interne (non mostrate)
    const lat = volo.lat;
    const lng = volo.lng;

    if (!lat || !lng) {
        alert("Posizione del volo non disponibile");
        throw new Error("Coordinate mancanti");
    }

    // ======================
    // MAPPA
    // ======================
    const map = L.map('map').setView([lat, lng], 7);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // ======================
    // ICONA SVG AEREO
    // ======================
    const planeIcon = L.divIcon({
        className: '',
        html: `
            <svg width="36" height="36" viewBox="0 0 24 24"
                 style="transform: rotate(${heading}deg)">
                <path fill="#2563eb"
                      d="M21 16v-2l-8-5V3.5
                         c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9
                         l-8 5v2l8-2.5V19l-2 1.5V22l3-1
                         3 1v-1.5L13 19v-5.5z"/>
            </svg>
        `,
        iconSize: [36, 36],
        iconAnchor: [ 0 , -5 ]
    });

    // ======================
    // MARKER + POPUP
    // ======================
    L.marker([lat, lng], { icon: planeIcon })
        .addTo(map)
        .bindPopup(`
			<strong>‚úàÔ∏è Volo:</strong> ${volo.flight_iata}<br>
			<strong>üõ´ Provenienza:</strong> ${volo.dep_iata}<br>
			<strong>üõ© Altitudine:</strong> ${altitude} ft<br>
			<strong>üß≠ Rotta:</strong> ${heading}¬∞<br>			
		`)
		.openPopup();

</script>

</body>
</html>
 -->
 <!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
	<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="apple-touch-icon" sizes="128x128" href="{{ url_for('static', filename='icon-128.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <title>Volo {{ volo.flight_iata }}</title>

    <!-- Mobile / PWA basics -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FlightMap">

    <!-- Leaflet -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .leaflet-popup-content {
            font-size: 14px;
        }

        /* ======================
           BOTTONI OVERLAY
        ====================== */
        .back-btn {
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 1000;

            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 20px;
            padding: 8px 14px;

            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            cursor: pointer;
        }

        .back-btn:active {
            transform: scale(0.96);
        }

    </style>
</head>

<body>

<!-- BOTTONI -->
<button class="back-btn" onclick="history.back()">‚Üê Arrivi</button>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    const volo = {{ volo | tojson }};

    // Dati essenziali
    const lat = volo.lat;
    const lng = volo.lng;
    const heading = volo.dir || 0;
    const altitude = volo.alt || "N/D";

    if (!lat || !lng) {
        alert("Posizione del volo non disponibile");
        throw new Error("Coordinate mancanti");
    }

    // ======================
    // MAPPA
    // ======================
    const map = L.map('map', {
        zoomControl: false
    }).setView([lat, lng], 7);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // ======================
    // ICONA SVG AEREO
    // ======================
    const planeIcon = L.divIcon({
        className: '',
        html: `
            <svg width="36" height="36" viewBox="0 0 24 24"
                 style="transform: rotate(${heading}deg)">
                <path fill="#2563eb"
                      d="M21 16v-2l-8-5V3.5
                         c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9
                         l-8 5v2l8-2.5V19l-2 1.5V22l3-1
                         3 1v-1.5L13 19v-5.5z"/>
            </svg>
        `,
        iconSize: [36, 36],
        iconAnchor: [18, 18]
    });

    // ======================
    // MARKER + POPUP
    // ======================
    L.marker([lat, lng], { icon: planeIcon })
        .addTo(map)
        .bindPopup(`
            <strong>‚úàÔ∏è Volo:</strong> ${volo.flight_iata}<br>
            <strong>üõ´ Provenienza:</strong> ${volo.dep_iata}<br>
            <strong>üõ© Altitudine:</strong> ${altitude} ft<br>
            <strong>üß≠ Rotta:</strong> ${heading}¬∞
        `)
        .openPopup();

</script>

</body>
</html>
